<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard MINTRAB - Reservas</title>
    <link href="https://fonts.googleapis.com/css2?family=Urbanist:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <style>
        /* --- VARIABLES --- */
        :root {
            --mintrab-blue: #002855; 
            --mintrab-light: #005eb8;
            --bg-body: #f8fafc;
            --text-main: #334155;
            
            /* Semáforo */
            --sem-green: #10b981;
            --sem-yellow: #f59e0b; 
            --sem-red: #ef4444;

            /* Fondos Semáforo */
            --bg-green-soft: #d1fae5;
            --bg-yellow-soft: #fef3c7;
            --bg-red-soft: #fee2e2;
        }

        * { box-sizing: border-box; }
        
        body {
            font-family: 'Urbanist', sans-serif;
            background-color: var(--bg-body);
            margin: 0;
            padding: 20px;
            color: var(--text-main);
            width: 100%;
            min-height: 100vh;
        }

        body.modal-open { overflow: hidden; }

        /* --- CONTENEDOR FLUIDO --- */
        .dashboard-container {
            width: 100%;
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.05);
            border-top: 8px solid var(--mintrab-blue);
        }

        /* --- HEADER --- */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            border-bottom: 2px solid #e2e8f0;
            padding-bottom: 20px;
            flex-wrap: wrap;
        }

        .header h1 {
            color: var(--mintrab-blue);
            margin: 0;
            font-weight: 800;
            font-size: 32px;
            text-transform: uppercase;
        }
        
        .header-meta {
            text-align: right;
            font-size: 14px;
            color: #64748b;
        }

        /* --- RESUMEN --- */
        .summary-section {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            flex-wrap: wrap;
            gap: 20px;
        }

        .global-card {
            background: white;
            border: 1px solid #e2e8f0;
            border-radius: 16px;
            padding: 15px 30px;
            display: flex;
            align-items: center;
            gap: 30px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.03);
            border-left: 6px solid var(--sem-green);
        }

        .global-info h2 { margin: 0; font-size: 12px; color: #64748b; text-transform: uppercase; font-weight: 700; letter-spacing: 1px; }
        .global-info p { margin: 5px 0 0 0; font-size: 36px; font-weight: 800; color: var(--mintrab-blue); }

        .chart-wrapper { position: relative; width: 70px; height: 70px; }
        svg { transform: rotate(-90deg); width: 100%; height: 100%; }
        .circle-bg { fill: none; stroke: #e2e8f0; stroke-width: 8; }
        .circle-progress {
            fill: none;
            stroke: var(--sem-green);
            stroke-width: 8;
            stroke-linecap: round;
            stroke-dasharray: 190; 
            stroke-dashoffset: 190; 
            transition: stroke-dashoffset 1.5s ease-in-out;
        }
        .chart-icon {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            color: var(--mintrab-blue); font-size: 16px;
        }

        .legend { display: flex; gap: 20px; font-size: 13px; color: #475569; flex-wrap: wrap;}
        .legend-item { display: flex; align-items: center; gap: 8px; font-weight: 600; }
        .dot { width: 12px; height: 12px; border-radius: 3px; }

        /* --- TABLA --- */
        .table-responsive { 
            width: 100%;
            overflow-x: auto; 
            border-radius: 8px; 
        }
        
        .dates-table { 
            width: 100%; 
            border-collapse: separate; 
            border-spacing: 0 8px; 
            font-size: 15px; 
            min-width: 800px;
        }
        
        .dates-table th { 
            text-align: left; padding: 15px 20px; 
            background-color: var(--mintrab-blue); color: white;
            font-weight: 700; text-transform: uppercase; font-size: 13px;
        }
        .dates-table th:first-child { border-top-left-radius: 8px; border-bottom-left-radius: 8px; }
        .dates-table th:last-child { border-top-right-radius: 8px; border-bottom-right-radius: 8px; }
        
        .dates-table td { 
            padding: 15px 20px; 
            color: #0f172a; 
            vertical-align: middle;
            border: none; 
        }
        .dates-table td:first-child { border-top-left-radius: 6px; border-bottom-left-radius: 6px; }
        .dates-table td:last-child { border-top-right-radius: 6px; border-bottom-right-radius: 6px; }

        .row-green { background-color: var(--bg-green-soft); }
        .row-green td:first-child { border-left: 6px solid var(--sem-green); }
        
        .row-yellow { background-color: var(--bg-yellow-soft); }
        .row-yellow td:first-child { border-left: 6px solid var(--sem-yellow); }
        
        .row-red { background-color: var(--bg-red-soft); }
        .row-red td:first-child { border-left: 6px solid var(--sem-red); }

        .dates-table tbody tr { transition: filter 0.2s; cursor: pointer; }
        .dates-table tbody tr:hover { filter: brightness(0.95); } 

        /* --- MODAL --- */
        #detail-overlay {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.5); backdrop-filter: blur(4px);
            justify-content: center; align-items: center; z-index: 2000; animation: fadeIn 0.3s;
        }
        .modal-card { 
            background: white; width: 600px; max-width: 90%; border-radius: 12px; padding: 40px; 
            box-shadow: 0 20px 50px rgba(0,0,0,0.2); position: relative; border-top: 6px solid #ccc;
        }
        .modal-header { display: flex; justify-content: space-between; margin-bottom: 30px; }
        .modal-title { font-size: 24px; font-weight: 800; color: var(--mintrab-blue); }
        .close-btn { font-size: 24px; cursor: pointer; color: #94a3b8; }
        
        .progress-track { width: 100%; height: 14px; background: #e2e8f0; border-radius: 10px; overflow: hidden; margin-top: 10px; }
        .progress-fill { height: 100%; width: 0%; transition: width 0.5s; }
        
        .fill-green { background: var(--sem-green); }
        .fill-yellow { background: var(--sem-yellow); }
        .fill-red { background: var(--sem-red); }

        .obs-box { 
            background: #f8fafc; padding: 20px; border-radius: 8px; margin-top: 25px; border-left: 4px solid #ccc; 
        }
        .obs-content {
            font-size: 14px; line-height: 1.6; color: #334155; 
            white-space: pre-wrap; 
        }

        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
        
        @media (max-width: 768px) {
            .header h1 { font-size: 22px; }
            .summary-section { flex-direction: column; align-items: stretch; }
            .legend { justify-content: flex-start; }
        }
    </style>
</head>
<body>

    <div class="dashboard-container">
        <header class="header">
            <div>
                <h1>Implementación Sistema de Reservas</h1>
                <div style="color: var(--mintrab-light); font-weight: 600; margin-top: 5px; font-size: 16px;">
                    <i class="fa-solid fa-layer-group"></i> Módulo: Centros Vacacionales y Recreativos
                </div>
            </div>
            <div class="header-meta">
                <strong style="color: var(--mintrab-blue);">MINTRAB 2025</strong><br>
                Dirección de Sistemas de Información DISI<br>
                <span>Actualizado: 19/12/2025</span>
            </div>
        </header>

        <div class="summary-section">
            <div class="global-card">
                <div class="global-info">
                    <h2>Avance Global</h2>
                    <p id="global-pct-text">0%</p>
                    <div style="font-size: 12px; color: #94a3b8; margin-top: 2px;">Promedio de <span id="module-count">0</span> submódulos</div>
                </div>
                <div class="chart-wrapper">
                    <svg viewBox="0 0 100 100">
                        <circle class="circle-bg" cx="50" cy="50" r="40"></circle>
                        <circle class="circle-progress" id="global-circle" cx="50" cy="50" r="40"></circle>
                    </svg>
                    <div class="chart-icon"><i class="fa-solid fa-chart-pie"></i></div>
                </div>
            </div>

            <div class="legend">
                <div class="legend-item"><div class="dot" style="background:var(--sem-green)"></div> ≥ 90% Óptimo</div>
                <div class="legend-item"><div class="dot" style="background:var(--sem-yellow)"></div> > 75% En Cierre</div>
                <div class="legend-item"><div class="dot" style="background:var(--sem-red)"></div> ≤ 75% En Proceso</div>
            </div>
        </div>

        <div class="table-responsive">
            <table class="dates-table">
                <thead>
                    <tr>
                        <th style="width: 30%;">Submódulo</th>
                        <th style="width: 25%;">Responsables</th>
                        <th style="width: 25%;">Fecha Entrega</th>
                        <th style="text-align: right; width: 20%;">Avance</th>
                    </tr>
                </thead>
                <tbody id="table-body">
                    </tbody>
            </table>
        </div>

        <div style="margin-top: 30px; text-align: center; font-size: 12px; color: #94a3b8;">
            Sistema de Gestión de Proyectos - MINTRAB
        </div>
    </div>

    <div id="detail-overlay" onclick="closeModal()">
        <div class="modal-card" id="modal-card-el" onclick="event.stopPropagation()">
            <div class="modal-header">
                <div class="modal-title" id="m-title">--</div>
                <div class="close-btn" onclick="closeModal()">&times;</div>
            </div>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px; margin-bottom: 30px;">
                <div><div style="font-size:11px; font-weight:700; color:#64748b; margin-bottom:5px;">RESPONSABLES</div><div style="font-weight:600;" id="m-resp">--</div></div>
                <div><div style="font-size:11px; font-weight:700; color:#64748b; margin-bottom:5px;">FECHA</div><div style="font-weight:600;" id="m-date">--</div></div>
            </div>
            <div style="margin-bottom: 30px;">
                <div style="display: flex; justify-content: space-between; align-items: flex-end;">
                    <div style="font-size:11px; font-weight:700; color:#64748b;">AVANCE</div>
                    <div style="font-size:24px; font-weight:800;" id="m-pct-text">0%</div>
                </div>
                <div class="progress-track"><div class="progress-fill" id="m-bar"></div></div>
            </div>
            <div class="obs-box" id="m-obs-box">
                <div style="font-weight:700; color:var(--mintrab-blue); margin-bottom:5px;"><i class="fa-solid fa-circle-info"></i> Observación / Estado:</div>
                <div class="obs-content" id="m-obs-text">--</div>
            </div>
        </div>
    </div>

    <script>
        const data = [
            { 
                name: "Carnet", 
                date: "19/12/2025", 
                pct: 28.00, 
                resp: "Herber", 
                obs: "Validar las apis que retornen la información correctas, a la vistas antes construidas y comenzar proceso de integración para actualización creación y aceptación de solicitud de carnet.\n\nBackend: Realizar la gestión de solicitud presencial.\nFrontEnd: Realizar las vista para la gestión de solicitud presencial." 
            },
            { 
                name: "Administración", 
                date: "18/12/2025 (Parcial)", 
                pct: 54.35, 
                resp: "Mynor, Herber, Elvin", 
                obs: "Mynor: 17.39% FrontEnd vistas e integración (En proceso) - 18/12/2025\nHerber: 17.39% FrontEnd vistas e integración (En proceso) - 16/12/2025\nElvin: 10.86% FrontEnd vistas e integración (No iniciado) - Sin fecha" 
            },
            { 
                name: "Crud de inventario de centro", 
                date: "Sin fecha", 
                pct: 78.95, 
                resp: "Herber, Elvin", 
                obs: "Herber: FrontEnd vistas e integración (No iniciado) - Sin fecha\nElvin: FrontEnd vistas e integración (No iniciado) - Sin fecha" 
            },
            { name: "Gestión de centros vacacionales", date: "18/12/2025", pct: 91.49, resp: "Mynor", obs: "Mynor: FrontEnd vistas e integración (No iniciado) No se tiene fecha porque esta esperando la parte de backend" },
            { name: "Configuraciones", date: "10/12/2025", pct: 100.00, resp: "Mynor", obs: "Finalizado" },
            { name: "Crud de inventario a búngalo", date: "Sin fecha", pct: 91.43, resp: "Elvin", obs: "No iniciado, No se tiene fecha, FrontEnd-integración" },
            { name: "Reservas", date: "Finalizado", pct: 100.00, resp: "Mynor, Herber, Elvin", obs: "Finalizado" },
            { name: "Check In", date: "16/12/2025", pct: 50.00, resp: "Elvin", obs: "Falta realizar la integración con la vista y verificar la funcionalidad" },
            { name: "Check Out", date: "16/12/2025", pct: 50.00, resp: "Elvin", obs: "Finalizara la parte de backend 16/12/2025. Faltaría realizar la integración con las vistas" },
            { name: "Reserva directa institucional", date: "Finalizado", pct: 100.00, resp: "Herber, Mynor", obs: "Finalizado" },
            { name: "Crud de centros vacacionales y recreativos", date: "18/12/2025", pct: 97.78, resp: "Mynor", obs: "80% de avance, en la integración le dio un error y solicito cambios para finalizar este proceso" },
            { name: "Crud de plazas y avenidas", date: "Finalizado", pct: 100.00, resp: "Mynor, Yeris", obs: "Finalizado" },
            { name: "Habilitación/Inhabilitación", date: "Finalizado", pct: 100.00, resp: "Yeris", obs: "Finalizado" },
            { name: "Institución Gubernamental", date: "Finalizado", pct: 100.00, resp: "Elvin, Herber", obs: "Finalizado" },
            { name: "Trabajadores del Estado", date: "18/12/2025", pct: 90.00, resp: "Herber", obs: "Falta implementar la parte de la solicitiud de carnet" }
        ];

        // ORDENAR: Mayor a Menor
        data.sort((a, b) => b.pct - a.pct);

        function getStyle(pct) {
            if (pct >= 90) return { row: 'row-green', fill: 'fill-green', color: '#10b981' };
            if (pct > 75) return { row: 'row-yellow', fill: 'fill-yellow', color: '#f59e0b' };
            return { row: 'row-red', fill: 'fill-red', color: '#ef4444' };
        }

        // CALCULO GLOBAL
        function initDashboard() {
            let sum = 0;
            data.forEach(d => sum += d.pct);
            const avg = (sum / data.length).toFixed(2);
            
            document.getElementById('module-count').innerText = data.length;
            document.getElementById('global-pct-text').innerText = avg + "%";
            
            const circle = document.getElementById('global-circle');
            const dashArray = 190;
            const offset = dashArray - (avg / 100) * dashArray;
            
            setTimeout(() => circle.style.strokeDashoffset = offset, 100);

            // Generar Tabla
            const tbody = document.getElementById('table-body');
            data.forEach((item, i) => {
                const s = getStyle(item.pct);
                
                // LÓGICA: Si es 100%, mostramos "Finalizado". Si no, la fecha normal.
                const displayDate = item.pct === 100 ? "Finalizado" : item.date;

                const row = `
                    <tr class="${s.row}" onclick="openModal(${i})">
                        <td style="font-weight:700;">${item.name}</td>
                        <td>${item.resp}</td>
                        <td style="font-weight:600;">${displayDate}</td>
                        <td style="text-align: right; font-weight:800;">${item.pct}%</td>
                    </tr>
                `;
                tbody.innerHTML += row;
            });
        }

        function openModal(idx) {
            document.body.classList.add('modal-open');
            const item = data[idx];
            const s = getStyle(item.pct);
            
            document.getElementById('detail-overlay').style.display = 'flex';
            document.getElementById('m-title').innerText = item.name;
            document.getElementById('m-resp').innerText = item.resp;
            
            // Lógica fecha modal
            const displayDate = item.pct === 100 ? "Finalizado" : item.date;
            document.getElementById('m-date').innerText = displayDate;
            
            const pctTxt = document.getElementById('m-pct-text');
            pctTxt.innerText = item.pct + "%";
            pctTxt.style.color = s.color;
            
            const bar = document.getElementById('m-bar');
            bar.className = 'progress-fill ' + s.fill;
            bar.style.width = item.pct + "%";
            
            document.getElementById('modal-card-el').style.borderTopColor = s.color;

            // Observaciones
            const obsBox = document.getElementById('m-obs-box');
            const obsTxt = document.getElementById('m-obs-text');
            
            if (item.obs && item.obs !== "Finalizado") {
                obsTxt.innerText = item.obs;
                obsBox.style.borderLeftColor = s.color;
                obsBox.style.background = "#fff"; 
            } else {
                obsTxt.innerText = item.pct >= 90 ? "Finalizado / Óptimo." : "En proceso.";
                obsBox.style.borderLeftColor = s.color;
            }
        }

        function closeModal() {
            document.body.classList.remove('modal-open');
            document.getElementById('detail-overlay').style.display = 'none';
        }

        initDashboard();
    </script>
</body>
</html>
